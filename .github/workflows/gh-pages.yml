name: Deploy GitHub Pages

on:
  push:
    branches: [ master ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: false
        
      - name: Setup Git and Debug Info
        run: |
          echo "GitHub Ref: ${{ github.ref }}"
          echo "GitHub SHA: ${{ github.sha }}"
          echo "GitHub Actor: ${{ github.actor }}"
          git config --global user.name "GitHub Actions"
          git config --global user.email "github-actions@github.com"
          git remote -v
          git branch -a
          git status
          echo "Checking git credentials..."
          git config --list
        
      - name: Test Git Push
        run: |
          # Create a test file to push
          echo "Test file" > test.txt
          git add test.txt
          git commit -m "Test commit"
          # Try to push with debug info
          GIT_CURL_VERBOSE=1 git push origin master 2>&1 || echo "Test push failed (expected)"
          # Clean up
          git reset --hard HEAD~1
          rm test.txt
        
      - name: Deploy to GitHub Pages with Debug
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: .
          publish_branch: gh-pages
          force_orphan: false
          keep_files: false
          enable_jekyll: false
          full_commit_message: ${{ github.event.head_commit.message }}
          verbose: true
          # Add debug flags
          deploy_key: ${{ secrets.GITHUB_TOKEN }}
          external_repository: ${{ github.repository }}
          publish_branch: gh-pages
          allow_empty_commit: true
